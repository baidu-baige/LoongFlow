<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Evolution Tree Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Prism.js for code highlighting -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css"
      id="prism-theme-light"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css"
      id="prism-theme-dark"
      disabled
    />
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script>
      // Configure Prism autoloader before loading the plugin
      window.Prism = window.Prism || {};
      Prism.plugins = Prism.plugins || {};
      Prism.plugins.autoloader = Prism.plugins.autoloader || {};
      Prism.plugins.autoloader.languages_path =
        "https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/";
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- Monaco Editor for code editing and diff viewing -->
    <script>
      // Configure Monaco Editor loader before loading
      require = {
        paths: {
          vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs",
        },
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script>
      // Ensure diff library is available globally
      if (typeof module !== "undefined" && module.exports) {
        // Node.js environment
      } else if (typeof window !== "undefined") {
        // Browser environment - diff library should be available as window.Diff
        // If not, we'll use the fallback simpleLineDiff function
      }
    </script>
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>

  <body class="dark-theme">
    <div class="app-container">
      <!-- Header -->
      <header class="app-header">
        <div class="header-content">
          <div class="header-title">
            <h1 class="title-text">LoongFlow Visualization</h1>
          </div>
          <button id="themeToggle" class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">
            <span class="theme-icon">ğŸŒ™</span>
          </button>
        </div>
      </header>

      <!-- Control Panel -->
      <div class="app-body">
        <div class="app-left">
          <div class="control-panel">
            <div class="control-section-row">
              <div class="control-section w-full mb-4">
                <label class="control-label">Checkpoint:</label>
                <div class="checkpoint-controls">
                  <button
                    id="playPauseBtn"
                    class="control-btn play-btn"
                    title="æ’­æ”¾/æš‚åœ"
                  >
                    <span id="playPauseIcon">â–¶</span>
                  </button>
                  <div class="playback-help">
                    <div class="playback-help-icon">?</div>
                    <div class="playback-help-tooltip">
                      <div class="font-semibold mb-2">æ’­æ”¾æ§åˆ¶è¯´æ˜ï¼š</div>
                      <div>â€¢ ç©ºæ ¼é”®ï¼šæ’­æ”¾/æš‚åœåˆ‡æ¢</div>
                      <div>â€¢ å·¦ç®­å¤´ï¼šä¸Šä¸€ä¸ªcheckpoint</div>
                      <div>â€¢ å³ç®­å¤´ï¼šä¸‹ä¸€ä¸ªcheckpoint</div>
                      <div>â€¢ æ’­æ”¾åˆ°æœ€åä¼šè‡ªåŠ¨å¾ªç¯</div>
                    </div>
                  </div>
                  <div class="slider-container">
                    <input
                      type="range"
                      id="checkpointSlider"
                      min="0"
                      max="0"
                      value="0"
                      step="1"
                      class="slider"
                    />
                    <div id="checkpointLabels" class="slider-labels"></div>
                  </div>
                  <div class="checkpoint-info">
                    <span id="currentCheckpoint">--</span>
                    <span class="separator">/</span>
                    <span id="totalCheckpoints">--</span>
                  </div>
                  <!-- <select id="playbackSpeed" class="speed-select">
                                <option value="500">0.5x</option>
                                <option value="1000" selected>1x</option>
                                <option value="2000">2x</option>
                                <option value="5000">5x</option>
                            </select> -->
                </div>
              </div>
            </div>
            <div class="control-section-row">
              <div class="control-section">
                <label class="control-label">è§†å›¾æ¨¡å¼:</label>
                <div class="view-mode-buttons">
                  <button
                    id="treeViewBtn"
                    class="view-mode-btn active"
                    data-view="tree"
                  >
                    æ ‘è§†å›¾
                  </button>
                  <button
                    id="islandViewBtn"
                    class="view-mode-btn"
                    data-view="island"
                  >
                    å²›å±¿è§†å›¾
                  </button>
                </div>
              </div>

              <div class="control-section" id="orientationContainer">
                <label class="control-label">å¸ƒå±€æ–¹å‘:</label>
                <select id="orientation" class="control-select">
                  <option value="vertical">å‚ç›´ (ä»ä¸Šåˆ°ä¸‹)</option>
                  <option value="vertical-bottom-up">å‚ç›´ (ä»ä¸‹åˆ°ä¸Š)</option>
                  <option value="horizontal">æ°´å¹³ (ä»å·¦åˆ°å³)</option>
                </select>
              </div>

              <div class="control-section">
                <label class="control-label">èŠ‚ç‚¹å¤§å°:</label>
                <div class="node-size-control">
                  <input
                    type="range"
                    id="nodeSize"
                    min="5"
                    max="20"
                    value="6"
                    step="1"
                    class="size-slider"
                  />
                  <span id="nodeSizeValue" class="size-value">6</span>
                </div>
              </div>

              <div class="control-section">
                <label class="control-label">æ˜¾ç¤ºæ ‡ç­¾:</label>
                <input
                  type="checkbox"
                  id="showLabels"
                  class="control-checkbox"
                />
              </div>

              <!-- <div class="control-section">
                        <label class="control-label">ç¼©æ”¾:</label>
                        <div class="zoom-controls">
                            <button id="zoomIn" class="control-btn" title="æ”¾å¤§">+</button>
                            <button id="zoomOut" class="control-btn" title="ç¼©å°">âˆ’</button>
                            <button id="resetZoom" class="control-btn" title="é‡ç½®ç¼©æ”¾">é‡ç½®</button>
                        </div>
                    </div> -->
            </div>
          </div>

          <!-- Main Content Area -->
          <div class="main-content">
            <!-- Visualization Area -->
            <div class="visualization-area">
              <div id="tree-container" class="tree-container"></div>
              <div id="loadingState" class="loading-state hidden"></div>
              <div id="tooltip" class="tooltip"></div>
              <!-- zoom-hint Legend -->
              <div
                class="legend zoom-hint"
                style="top: 20px; right: 20px; left: auto"
              >
                <div class="hint-title">ç¼©æ”¾æç¤º</div>
                <div class="hint-text">æ»šè½®ï¼šç¼©æ”¾</div>
                <div class="hint-text">æ‹–æ‹½ï¼šå¹³ç§»</div>
              </div>
              <!-- Island Legend -->
              <div
                class="legend island-legend"
                style="top: 20px; left: 20px; right: auto"
              >
                <div class="legend-title">å²›å±¿</div>
                <div id="islandLegendItems" class="legend-items">
                  <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
              </div>
              <div
                class="legend solution-legend"
                style="top: 140px; left: 20px; right: auto"
              >
                <div class="legend-title">æœ€ä¼˜è§£</div>
                <div class="legend-item">
                  <span class="legend-badge elite">Elite</span>
                  <span class="legend-text">ç²¾è‹±è§£</span>
                </div>
                <div class="legend-item">
                  <span class="legend-badge best">Best</span>
                  <span class="legend-text">æœ€ä½³è§£</span>
                </div>
                <div class="legend-item">
                  <span class="legend-badge island-best">Island Best</span>
                  <span class="legend-text">å²›æœ€ä½³è§£</span>
                </div>
              </div>
            </div>

            <!-- Statistics Panel -->
            <div class="stats-panel">
              <div class="stat-card">
                <div class="stat-label">æ€»è§£å†³æ–¹æ¡ˆæ•°</div>
                <div class="stat-value" id="totalSolutions">--</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">æœ‰æ•ˆè§£å†³æ–¹æ¡ˆæ•°</div>
                <div class="stat-value" id="validSolutions">--</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">æœ€ä½³åˆ†æ•°</div>
                <div class="stat-value" id="bestScore">--</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">è¿­ä»£æ¬¡æ•°</div>
                <div class="stat-value" id="iterations">--</div>
              </div>
              <div id="scoreChartCard" class="chart-card">
                <div class="chart-card-header">
                  <div class="chart-title">è¿›åŒ–åˆ†æ•°è¶‹åŠ¿</div>
                  <div id="scoreChartSummary" class="chart-subtitle"></div>
                  <div class="chart-actions">
                    <button
                      id="scoreChartExpandBtn"
                      class="mini-btn"
                      title="æ”¾å¤§æŸ¥çœ‹"
                    >
                      æ”¾å¤§
                    </button>
                  </div>
                </div>
                <div id="scoreChartContainer" class="chart-container">
                  <svg id="scoreChart"></svg>
                  <div id="scoreChartEmpty" class="chart-empty">
                    æš‚æ—  score æ•°æ®
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            id="scoreChartExpandedSection"
            class="expanded-chart-panel hidden"
          >
            <div class="expanded-chart-header">
              <div class="chart-title">è¿›åŒ–åˆ†æ•°è¶‹åŠ¿</div>
              <div id="scoreChartExpandedSummary" class="chart-subtitle"></div>
              <div class="chart-actions">
                <button
                  id="scoreChartCollapse"
                  class="mini-btn"
                  title="æ”¶èµ·æ”¾å¤§å›¾"
                >
                  æ”¶èµ·
                </button>
              </div>
            </div>
            <div
              id="scoreChartExpandedContainer"
              class="chart-container expanded"
            >
              <svg id="scoreChartExpanded"></svg>
              <div id="scoreChartExpandedEmpty" class="chart-empty">
                æš‚æ—  score æ•°æ®
              </div>
            </div>
          </div>
        </div>
        <div class="app-right">
          <div id="resizeHandle" class="resize-handle"></div>
          <!-- Node Details Panel -->
          <div id="nodeDetailsPanel" class="node-details-panel hidden">
            <div class="panel-header">
              <h3 class="panel-title" id="nodeTitle">Node</h3>
              <button id="closeNodePanel" class="close-btn">Ã—</button>
            </div>
            <div class="panel-tabs">
              <button class="tab-btn active" data-tab="detail">Detail</button>
              <button class="tab-btn" data-tab="code">Code</button>
              <button class="tab-btn" data-tab="diff">Diff</button>
            </div>
            <div class="panel-content">
              <div id="detailTab" class="tab-content active">
                <div class="detail-view-controls">
                  <button class="detail-mode-btn active" data-mode="formatted">
                    Formatted
                  </button>
                  <button class="detail-mode-btn" data-mode="raw">
                    Raw (JSON)
                  </button>
                </div>
                <div
                  id="detailFormattedContent"
                  class="detail-content-mode active"
                  style="
                    padding: 10px;
                    overflow-y: auto;
                    height: calc(100% - 40px);
                  "
                >
                  <!-- Formatted content populated by JS -->
                </div>
                <div
                  id="detailRawContent"
                  class="detail-content-mode hidden"
                  style="height: calc(100% - 40px)"
                >
                  <pre
                    id="rawJsonContent"
                    class="code-content"
                    style="margin: 0; height: 100%; overflow: auto"
                  ></pre>
                </div>
              </div>
              <div id="codeTab" class="tab-content">
                <div class="code-container">
                  <button id="copyCodeBtn" class="copy-btn" title="å¤åˆ¶ä»£ç ">
                    <span class="copy-icon">ğŸ“‹</span>
                    <span class="copy-text">å¤åˆ¶</span>
                  </button>
                  <div
                    id="codeContent"
                    class="code-content monaco-editor-container"
                  ></div>
                </div>
              </div>
              <div id="diffTab" class="tab-content">
                <div class="code-container">
                  <div
                    id="diffContent"
                    class="code-content monaco-editor-container"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <select id="checkpointSelect" class="hidden">
      <option value="">åŠ è½½ä¸­...</option>
    </select>

    <script src="/static/js/app.js"></script>
  </body>
</html>
